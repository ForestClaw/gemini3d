<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="GEMINI3D is a modular ionospheric model that incorporates kinetic models such as Fang, GLOW.">
    
    <meta name="author" content="Matthew Zettergren
Guy Grubbs
Michael Hirsch" >
    <link rel="icon" href="../favicon.png">

    <title>multifluid.f90 &ndash; GEMINI3D</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">GEMINI3D </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
    <li><a href="../blockdata/gtd7bk.html">Block Data</a></li>
    
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../lists/programs.html">Programs</a></li>
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../blockdata/gtd7bk.html">Block Data</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>multifluid.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.4% of total for source files.">322 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/multifluid.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">multifluid.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/multifluid.html">multifluid</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/multifluid.f90.html#src">multifluid.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~multifluid.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemultifluidf90EfferentGraph" width="641pt" height="671pt"
 viewBox="0.00 0.00 641.00 671.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~multifluid.f90~~EfferentGraph" class="graph" transform="scale(.9092 .9092) rotate(0) translate(4 734)">
<title>sourcefile~~multifluid.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-734 701,-734 701,4 -4,4"/>
<!-- sourcefile~multifluid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~multifluid.f90</title>
<polygon fill="none" stroke="#000000" points="697,-576 624,-576 624,-552 697,-552 697,-576"/>
<text text-anchor="middle" x="660.5" y="-561.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">multifluid.f90</text>
</g>
<!-- sourcefile~ionization.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~ionization.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/ionization.f90.html" xlink:title="ionization.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="588,-576 512,-576 512,-552 588,-552 588,-576"/>
<text text-anchor="middle" x="550" y="-561.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ionization.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~ionization.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~ionization.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M623.7051,-564C615.5817,-564 606.8569,-564 598.3535,-564"/>
<polygon fill="#000000" stroke="#000000" points="598.1463,-560.5001 588.1463,-564 598.1463,-567.5001 598.1463,-560.5001"/>
</g>
<!-- sourcefile~precipbcs_mod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~precipbcs_mod.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/precipbcs_mod.f90.html" xlink:title="precipBCs_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="476,-534 370,-534 370,-510 476,-510 476,-534"/>
<text text-anchor="middle" x="423" y="-519.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precipBCs_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~precipbcs_mod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~precipbcs_mod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C484.0309,-279.9909 532.4926,-437.1326 476,-496 472.841,-499.2918 469.178,-502.225 465.2819,-504.8247"/>
<polygon fill="#000000" stroke="#000000" points="463.3342,-501.9095 456.4853,-509.993 466.8803,-507.9449 463.3342,-501.9095"/>
</g>
<!-- sourcefile~timeutils.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~timeutils.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/timeutils.f90.html" xlink:title="timeutils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="321.5,-690 251.5,-690 251.5,-666 321.5,-666 321.5,-690"/>
<text text-anchor="middle" x="286.5" y="-675.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">timeutils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~timeutils.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~timeutils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M623.9126,-575.8888C612.5073,-579.2449 599.8196,-582.625 588,-585 515.6286,-599.5418 492.9185,-580.3253 423,-604"/>
</g>
<!-- sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~phys_consts.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/phys_consts.f90.html" xlink:title="phys_consts.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="94,-458 0,-458 0,-434 94,-434 94,-458"/>
<text text-anchor="middle" x="47" y="-443.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">phys_consts.F90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-368C383.5114,-376.7524 373.9197,-380.4907 334,-387 260.0548,-399.0576 239.2012,-387.8943 166.5,-406"/>
</g>
<!-- sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~grid.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/grid.f90.html" xlink:title="grid.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="313.5,-378 259.5,-378 259.5,-354 313.5,-354 313.5,-378"/>
<text text-anchor="middle" x="286.5" y="-363.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">grid.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C544.0189,-323.6473 430.222,-366.3993 423,-368"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-368C389.9665,-375.3217 351.3263,-373.8553 323.6056,-371.1255"/>
<polygon fill="#000000" stroke="#000000" points="323.8701,-367.6337 313.5506,-370.0331 323.114,-374.5928 323.8701,-367.6337"/>
</g>
<!-- sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~mpimod.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/mpimod.f90.html" xlink:title="mpimod.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="203,-458 130,-458 130,-434 203,-434 203,-458"/>
<text text-anchor="middle" x="166.5" y="-443.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpimod.F90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~mpimod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C517.0801,-304.0425 512.7329,-364.4395 476,-382 389.1929,-423.4988 276.0908,-438.1746 213.4469,-443.3026"/>
<polygon fill="#000000" stroke="#000000" points="212.7979,-439.8422 203.0963,-444.1001 213.3357,-446.8215 212.7979,-439.8422"/>
</g>
<!-- sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~mesh.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/mesh.f90.html" xlink:title="mesh.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="195,-340 138,-340 138,-316 195,-316 195,-340"/>
<text text-anchor="middle" x="166.5" y="-325.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mesh.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C497.4358,-288.0555 315.5699,-286.8961 286.5,-288"/>
</g>
<!-- sourcefile~advec_mpi.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~advec_mpi.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/advec_mpi.f90.html" xlink:title="advec_mpi.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="464,-340 382,-340 382,-316 464,-316 464,-340"/>
<text text-anchor="middle" x="423" y="-325.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">advec_mpi.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~advec_mpi.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~advec_mpi.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C528.6123,-312.4351 499.379,-311.4587 474.3507,-314.8158"/>
<polygon fill="#000000" stroke="#000000" points="473.6002,-311.3912 464.2767,-316.4234 474.7033,-318.3037 473.6002,-311.3912"/>
</g>
<!-- sourcefile~collisions.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~collisions.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/collisions.f90.html" xlink:title="collisions.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="323,-24 250,-24 250,0 323,0 323,-24"/>
<text text-anchor="middle" x="286.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">collisions.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~collisions.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~collisions.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M658.9158,-551.9068C653.017,-512.1998 628.4635,-385.1019 550,-328"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C453.6918,-257.9116 515.537,-166.9971 423,-92"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-92C391.1739,-66.2064 350.1022,-43.3145 321.3593,-28.6977"/>
<polygon fill="#000000" stroke="#000000" points="322.6239,-25.4166 312.1155,-24.0657 319.4879,-31.6748 322.6239,-25.4166"/>
</g>
<!-- sourcefile~calculus.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~calculus.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/calculus.f90.html" xlink:title="calculus.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="321,-104 252,-104 252,-80 321,-80 321,-104"/>
<text text-anchor="middle" x="286.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">calculus.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~calculus.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~calculus.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-92C397.7202,-71.5118 360.289,-73.0021 331.0146,-78.788"/>
<polygon fill="#000000" stroke="#000000" points="330.0473,-75.417 321.0333,-80.9847 331.5519,-82.2534 330.0473,-75.417"/>
</g>
<!-- sourcefile~sources.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~sources.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/sources.f90.html" xlink:title="sources.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="457,-218 389,-218 389,-194 457,-194 457,-218"/>
<text text-anchor="middle" x="423" y="-203.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sources.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~sources.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~sources.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C505.0058,-295.2554 520.0342,-261.0247 476,-227 473.0043,-224.6853 469.7207,-222.5935 466.3019,-220.7096"/>
<polygon fill="#000000" stroke="#000000" points="467.5647,-217.4316 457.0419,-216.1984 464.4989,-223.7245 467.5647,-217.4316"/>
</g>
<!-- sourcefile~diffusion.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~diffusion.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/diffusion.f90.html" xlink:title="diffusion.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="458,-260 388,-260 388,-236 458,-236 458,-260"/>
<text text-anchor="middle" x="423" y="-245.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">diffusion.f90</text>
</a>
</g>
</g>
<!-- sourcefile~multifluid.f90&#45;&gt;sourcefile~diffusion.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~multifluid.f90&#45;&gt;sourcefile~diffusion.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M550,-328C517.0801,-304.0425 510.8533,-295.0458 476,-274 470.5878,-270.7319 464.7065,-267.5292 458.8965,-264.55"/>
<polygon fill="#000000" stroke="#000000" points="460.4148,-261.3962 449.9026,-260.0752 457.2966,-267.6633 460.4148,-261.3962"/>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~timeutils.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~timeutils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M511.7946,-575.567C486.5094,-583.3367 452.6681,-593.9543 423,-604"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-604C420.1931,-604.9504 356.8003,-639.531 317.4043,-661.0782"/>
<polygon fill="#000000" stroke="#000000" points="315.5285,-658.1148 308.4356,-665.9851 318.8884,-664.2558 315.5285,-658.1148"/>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M540.3159,-576.2643C507.8666,-615.7853 398.6884,-736.2057 286.5,-718"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-718C222.4035,-717.4689 219.7761,-673.6413 166.5,-638"/>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M538.4755,-551.8191C524.7348,-537.8951 500.5318,-515.2011 476,-501 454.3435,-488.4634 445.7889,-492.3362 423,-482"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-482C372.9493,-459.2989 326.9537,-412.6624 303.2651,-385.9538"/>
<polygon fill="#000000" stroke="#000000" points="305.8552,-383.5984 296.6499,-378.3532 300.575,-388.1941 305.8552,-383.5984"/>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~mpimod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423,-482C365.6497,-455.9881 346.9146,-537.7695 286.5,-520"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-520C248.8132,-508.9153 211.2148,-482.6437 188.4068,-464.5845"/>
<polygon fill="#000000" stroke="#000000" points="190.3936,-461.6896 180.4203,-458.114 185.987,-467.1286 190.3936,-461.6896"/>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M541.9394,-551.7583C529.1494,-532.7782 502.8892,-495.5674 476,-468 433.64,-424.5717 413.8456,-423.928 370,-382 329.6133,-343.3796 342.2976,-284.9586 286.5,-288"/>
</g>
<!-- sourcefile~fang.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~fang.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/fang.f90.html" xlink:title="fang.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="193.5,-730 139.5,-730 139.5,-706 193.5,-706 193.5,-730"/>
<text text-anchor="middle" x="166.5" y="-715.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fang.f90</text>
</a>
</g>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~fang.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~fang.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-718C259.0924,-713.5524 227.6977,-713.7357 203.8958,-714.9337"/>
<polygon fill="#000000" stroke="#000000" points="203.644,-711.4423 193.8655,-715.5204 204.0528,-718.4304 203.644,-711.4423"/>
</g>
<!-- sourcefile~neutral.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~neutral.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/neutral.f90.html" xlink:title="neutral.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="455,-576 391,-576 391,-552 455,-552 455,-576"/>
<text text-anchor="middle" x="423" y="-561.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">neutral.f90</text>
</a>
</g>
</g>
<!-- sourcefile~ionization.f90&#45;&gt;sourcefile~neutral.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~ionization.f90&#45;&gt;sourcefile~neutral.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M511.8958,-564C497.1735,-564 480.2706,-564 465.1837,-564"/>
<polygon fill="#000000" stroke="#000000" points="465.0783,-560.5001 455.0782,-564 465.0782,-567.5001 465.0783,-560.5001"/>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~timeutils.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~timeutils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M381.6095,-534.067C377.3236,-536.5257 373.3279,-539.4723 370,-543 334.9905,-580.1107 366.6512,-612.7984 334,-652 331.4335,-655.0813 328.4036,-657.8577 325.1358,-660.3451"/>
<polygon fill="#000000" stroke="#000000" points="323.0714,-657.5139 316.6517,-665.9423 326.9262,-663.3569 323.0714,-657.5139"/>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M387.5773,-534.037C360.3135,-542.6389 321.4989,-553.4623 286.5,-558"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-558C198.5294,-569.4055 106.8923,-499.7655 67.2563,-464.9425"/>
<polygon fill="#000000" stroke="#000000" points="69.3889,-462.1536 59.6078,-458.0818 64.7148,-467.3645 69.3889,-462.1536"/>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M391.2485,-509.905C383.7791,-506.1546 376.1975,-501.5235 370,-496 335.0438,-464.8453 308.9351,-415.7327 295.8614,-387.6386"/>
<polygon fill="#000000" stroke="#000000" points="298.9526,-385.98 291.6423,-378.3113 292.5748,-388.865 298.9526,-385.98"/>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~mpimod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M369.8304,-527.7773C344.164,-528.9239 313.2164,-527.858 286.5,-520"/>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M369.8536,-510.699C337.4164,-502.9978 299.7187,-492.356 286.5,-482"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-482C237.6562,-443.734 197.3055,-381.4471 178.2776,-349.0608"/>
<polygon fill="#000000" stroke="#000000" points="181.0979,-346.9449 173.0712,-340.0295 175.0334,-350.441 181.0979,-346.9449"/>
</g>
<!-- sourcefile~interpolation.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~interpolation.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/interpolation.f90.html" xlink:title="interpolation.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="331,-610 242,-610 242,-586 331,-586 331,-610"/>
<text text-anchor="middle" x="286.5" y="-595.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">interpolation.f90</text>
</a>
</g>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~interpolation.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~interpolation.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M388.0783,-534.0968C381.9001,-536.7218 375.6437,-539.7108 370,-543 352.2491,-553.3454 351.0783,-560.5783 334,-572 329.409,-575.0704 324.4235,-578.1009 319.4664,-580.9481"/>
<polygon fill="#000000" stroke="#000000" points="317.7029,-577.9239 310.6656,-585.844 321.1059,-584.0411 317.7029,-577.9239"/>
</g>
<!-- sourcefile~reader.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~reader.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/reader.f90.html" xlink:title="reader.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="197.5,-590 135.5,-590 135.5,-566 197.5,-566 197.5,-590"/>
<text text-anchor="middle" x="166.5" y="-575.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">reader.f90</text>
</a>
</g>
</g>
<!-- sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~reader.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~precipbcs_mod.f90&#45;&gt;sourcefile~reader.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-558C260.3444,-561.3911 231.1528,-566.2327 208.1106,-570.3029"/>
<polygon fill="#000000" stroke="#000000" points="207.2181,-566.9068 197.9894,-572.1107 208.449,-573.7978 207.2181,-566.9068"/>
</g>
<!-- sourcefile~timeutils.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~timeutils.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M251.4569,-671.5216C226.2651,-665.6765 192.3272,-655.2782 166.5,-638"/>
</g>
<!-- sourcefile~grid.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~grid.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M259.2142,-376.447C235.1218,-385.3444 198.8903,-397.9335 166.5,-406"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M166.5,-406C140.0552,-412.5859 111.0521,-422.2332 88.2417,-430.4034"/>
<polygon fill="#000000" stroke="#000000" points="86.7574,-427.2186 78.5502,-433.9188 89.1444,-433.799 86.7574,-427.2186"/>
</g>
<!-- sourcefile~grid.f90&#45;&gt;sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~grid.f90&#45;&gt;sourcefile~mpimod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M268.2746,-378.1503C248.2473,-391.5018 215.8928,-413.0715 193.0476,-428.3016"/>
<polygon fill="#000000" stroke="#000000" points="190.8828,-425.5383 184.5037,-433.9975 194.7657,-431.3626 190.8828,-425.5383"/>
</g>
<!-- sourcefile~grid.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~grid.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M259.2701,-357.3772C243.3158,-352.325 222.9023,-345.8607 205.2881,-340.2829"/>
<polygon fill="#000000" stroke="#000000" points="205.8855,-336.8008 195.2955,-337.1186 203.7722,-343.4742 205.8855,-336.8008"/>
</g>
<!-- sourcefile~grid.f90&#45;&gt;sourcefile~reader.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~grid.f90&#45;&gt;sourcefile~reader.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M279.7045,-378.0055C260.1143,-412.6147 203.3422,-512.9121 178.4425,-556.9016"/>
<polygon fill="#000000" stroke="#000000" points="175.2499,-555.4367 173.3698,-565.8634 181.3417,-558.885 175.2499,-555.4367"/>
</g>
<!-- sourcefile~mpimod.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~mpimod.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M129.9967,-446C121.906,-446 113.1415,-446 104.4424,-446"/>
<polygon fill="#000000" stroke="#000000" points="104.3047,-442.5001 94.3046,-446 104.3046,-449.5001 104.3047,-442.5001"/>
</g>
<!-- sourcefile~mesh.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~mesh.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M154.1615,-340.1836C133.4987,-360.5871 91.7232,-401.8381 66.875,-426.3745"/>
<polygon fill="#000000" stroke="#000000" points="64.1068,-424.1891 59.4504,-433.7059 69.0252,-429.17 64.1068,-424.1891"/>
</g>
<!-- sourcefile~advec_mpi.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~advec_mpi.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M409.1735,-315.9996C367.9199,-281.6838 243.7839,-189.4008 166.5,-250"/>
</g>
<!-- sourcefile~advec_mpi.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~advec_mpi.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M381.6751,-339.5044C363.2229,-344.6412 341.6436,-350.6487 323.7022,-355.6434"/>
<polygon fill="#000000" stroke="#000000" points="322.5767,-352.3235 313.8818,-358.3772 324.4541,-359.0671 322.5767,-352.3235"/>
</g>
<!-- sourcefile~advec_mpi.f90&#45;&gt;sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~advec_mpi.f90&#45;&gt;sourcefile~mpimod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M381.8047,-320.9282C341.7132,-316.3711 280.8756,-315.8753 239,-345 208.6454,-366.1118 226.8106,-391.7128 203,-420 200.7266,-422.7008 198.1124,-425.261 195.3497,-427.6456"/>
<polygon fill="#000000" stroke="#000000" points="193.0824,-424.9748 187.3299,-433.8719 197.3752,-430.5041 193.0824,-424.9748"/>
</g>
<!-- sourcefile~advec_mpi.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~advec_mpi.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M399.4268,-315.8173C372.6747,-303.2501 327.4321,-285.7689 286.5,-288"/>
</g>
<!-- sourcefile~collisions.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~collisions.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M249.9485,-19.5062C225.136,-25.6892 192.2794,-36.0681 166.5,-52"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M166.5,-52C100.7214,-92.6519 60.7718,-346.0179 49.9769,-423.5086"/>
<polygon fill="#000000" stroke="#000000" points="46.4815,-423.2377 48.5962,-433.6193 53.4172,-424.1849 46.4815,-423.2377"/>
</g>
<!-- sourcefile~calculus.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~calculus.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M263.7392,-79.8755C233.7807,-64.6859 182.9857,-41.8116 166.5,-52"/>
</g>
<!-- sourcefile~calculus.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~calculus.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M251.6918,-102.7688C246.9096,-105.4802 242.4614,-108.8424 239,-113 194.8564,-166.0212 228.3452,-199.8321 203,-264 197.0088,-279.1683 187.9315,-295.1028 180.3284,-307.2778"/>
<polygon fill="#000000" stroke="#000000" points="177.328,-305.4728 174.877,-315.7803 183.2209,-309.251 177.328,-305.4728"/>
</g>
<!-- sourcefile~sources.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~sources.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M416.7306,-193.8531C400.8426,-163.5657 358.5241,-86.0508 334,-71 302.0724,-51.4055 198.3665,-32.3062 166.5,-52"/>
</g>
<!-- sourcefile~sources.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~sources.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M388.8491,-215.1783C382.0464,-218.1448 375.3576,-222.0062 370,-227 342.9528,-252.2103 353.105,-270.3439 334,-302 324.7948,-317.2526 312.8342,-333.3513 303.218,-345.587"/>
<polygon fill="#000000" stroke="#000000" points="300.2076,-343.748 296.7033,-353.7465 305.6779,-348.1156 300.2076,-343.748"/>
</g>
<!-- sourcefile~sources.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~sources.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M388.8471,-215.4091C350.9287,-226.5765 288.5415,-247.1223 239,-274 220.7215,-283.9166 201.9423,-298.0339 188.0773,-309.347"/>
<polygon fill="#000000" stroke="#000000" points="185.5731,-306.8775 180.1278,-315.9659 190.0522,-312.257 185.5731,-306.8775"/>
</g>
<!-- sourcefile~sources.f90&#45;&gt;sourcefile~collisions.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~sources.f90&#45;&gt;sourcefile~collisions.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M416.6348,-193.9944C406.6822,-175.2217 386.8312,-137.7747 370,-106 353.9931,-75.7815 358.0115,-62.3481 334,-38 330.9552,-34.9125 327.4656,-32.0936 323.7904,-29.5467"/>
<polygon fill="#000000" stroke="#000000" points="325.3435,-26.3916 314.9997,-24.099 321.6562,-32.3417 325.3435,-26.3916"/>
</g>
<!-- sourcefile~sources.f90&#45;&gt;sourcefile~calculus.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~sources.f90&#45;&gt;sourcefile~calculus.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M414.0696,-193.9871C399.2516,-174.7393 367.8442,-136.7462 334,-113 331.901,-111.5273 329.6823,-110.1227 327.3962,-108.7891"/>
<polygon fill="#000000" stroke="#000000" points="328.8321,-105.5892 318.3564,-104.0046 325.5575,-111.776 328.8321,-105.5892"/>
</g>
<!-- sourcefile~diffusion.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~diffusion.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M387.8983,-236.04C333.9835,-220.0929 230.345,-199.3522 166.5,-250"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M166.5,-250C101.8589,-292.1585 66.635,-382.6835 53.3105,-424.2824"/>
<polygon fill="#000000" stroke="#000000" points="49.9256,-423.382 50.3238,-433.9694 56.6149,-425.4445 49.9256,-423.382"/>
</g>
<!-- sourcefile~diffusion.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~diffusion.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M408.9062,-260.1836C385.0996,-280.7637 336.7574,-322.554 308.4696,-347.008"/>
<polygon fill="#000000" stroke="#000000" points="305.9978,-344.5182 300.7216,-353.7059 310.5757,-349.8138 305.9978,-344.5182"/>
</g>
<!-- sourcefile~diffusion.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~diffusion.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M395.6897,-260.0598C368.5953,-271.0439 325.5827,-285.8697 286.5,-288"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-288C255.8569,-289.6703 222.9103,-301.4365 199.3063,-311.7786"/>
<polygon fill="#000000" stroke="#000000" points="197.7781,-308.6284 190.1126,-315.9421 200.6659,-315.005 197.7781,-308.6284"/>
</g>
<!-- sourcefile~pdeparabolic.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~pdeparabolic.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/pdeparabolic.f90.html" xlink:title="PDEparabolic.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="334,-146 239,-146 239,-122 334,-122 334,-146"/>
<text text-anchor="middle" x="286.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">PDEparabolic.f90</text>
</a>
</g>
</g>
<!-- sourcefile~diffusion.f90&#45;&gt;sourcefile~pdeparabolic.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~diffusion.f90&#45;&gt;sourcefile~pdeparabolic.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M387.9153,-238.1481C381.4815,-235.265 375.1742,-231.6072 370,-227 344.7537,-204.5202 357.8101,-183.9958 334,-160 330.9457,-156.9219 327.4501,-154.109 323.7712,-151.5656"/>
<polygon fill="#000000" stroke="#000000" points="325.3214,-148.4089 314.9763,-146.1221 321.6374,-154.3611 325.3214,-148.4089"/>
</g>
<!-- sourcefile~interpolation.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~interpolation.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M264.1392,-610.0337C234.1242,-625.4162 182.699,-648.837 166.5,-638"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M166.5,-638C103.7583,-596.0263 67.8549,-508.8028 53.8663,-467.9725"/>
<polygon fill="#000000" stroke="#000000" points="57.1716,-466.8198 50.7081,-458.4249 50.5257,-469.0181 57.1716,-466.8198"/>
</g>
<!-- sourcefile~reader.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~reader.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M147.1249,-565.7488C141.3441,-561.694 135.1747,-556.9452 130,-552 102.0791,-525.3174 75.6232,-488.9194 60.373,-466.4636"/>
<polygon fill="#000000" stroke="#000000" points="63.2042,-464.4011 54.7332,-458.0377 57.3871,-468.2948 63.2042,-464.4011"/>
</g>
<!-- sourcefile~fang.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~fang.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M159.0367,-705.5868C151.3092,-692.4964 139.1135,-671.1545 130,-652 98.8071,-586.4394 68.5972,-505.8747 54.7999,-467.847"/>
<polygon fill="#000000" stroke="#000000" points="58.041,-466.5169 51.3564,-458.297 51.456,-468.8914 58.041,-466.5169"/>
</g>
<!-- sourcefile~pdeparabolic.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~pdeparabolic.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M255.6897,-121.9093C249.9913,-119.2489 244.2016,-116.2457 239,-113 203.2742,-90.7076 202.3216,-29.8619 166.5,-52"/>
</g>
<!-- sourcefile~gbsv.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~gbsv.f90</title>
<g id="a_sourcefile~~multifluid.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/gbsv.f90.html" xlink:title="gbsv.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="193.5,-146 139.5,-146 139.5,-122 193.5,-122 193.5,-146"/>
<text text-anchor="middle" x="166.5" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">gbsv.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pdeparabolic.f90&#45;&gt;sourcefile~gbsv.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~pdeparabolic.f90&#45;&gt;sourcefile~gbsv.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M238.728,-134C227.1379,-134 214.9121,-134 203.8812,-134"/>
<polygon fill="#000000" stroke="#000000" points="203.7311,-130.5001 193.731,-134 203.731,-137.5001 203.7311,-130.5001"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~timeutils.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~timeutils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M390.796,-576.0415C383.4216,-579.7729 375.997,-584.4087 370,-590 346.6942,-611.729 356.8138,-629.755 334,-652 330.8953,-655.0272 327.3675,-657.8077 323.6696,-660.3319"/>
<polygon fill="#000000" stroke="#000000" points="321.5381,-657.5338 314.8521,-665.7526 325.2041,-663.4971 321.5381,-657.5338"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~phys_consts.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~phys_consts.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-638C233.5888,-644.6969 210.8284,-667.6553 166.5,-638"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~grid.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~grid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M390.7558,-555.6673C383.2986,-552.6025 375.846,-548.4858 370,-543 368.4491,-541.5447 318.2064,-434.0072 296.4175,-387.2828"/>
<polygon fill="#000000" stroke="#000000" points="299.5088,-385.6303 292.1112,-378.0457 293.1644,-388.5881 299.5088,-385.6303"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~mpimod.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~mpimod.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M390.8767,-553.1284C363.307,-543.9222 322.4497,-530.5737 286.5,-520"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~mesh.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge61" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~mesh.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M390.7997,-553.7586C383.6614,-550.813 376.3403,-547.2284 370,-543 350.9117,-530.2698 352.4922,-519.5815 334,-506 314.9364,-491.9988 305.1193,-496.587 286.5,-482"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~interpolation.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~interpolation.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M390.9968,-571.9715C376.1099,-575.6796 357.9817,-580.195 341.0311,-584.4172"/>
<polygon fill="#000000" stroke="#000000" points="340.0778,-581.0476 331.2203,-586.8609 341.7698,-587.84 340.0778,-581.0476"/>
</g>
<!-- sourcefile~neutral.f90&#45;&gt;sourcefile~reader.f90 -->
<g id="sourcefile~~multifluid.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~neutral.f90&#45;&gt;sourcefile~reader.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M395.4069,-576.1036C387.0348,-580.1524 377.953,-584.9349 370,-590 352.6705,-601.0368 351.7341,-608.6257 334,-619 314.3741,-630.481 309.0574,-635.1449 286.5,-638"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M286.5,-638C248.2201,-642.845 209.2339,-616.2958 186.4844,-596.9536"/>
<polygon fill="#000000" stroke="#000000" points="188.6805,-594.2235 178.869,-590.2251 184.0456,-599.4693 188.6805,-594.2235"/>
</g>
</g>
</svg>
</div><script>var pansourcefilemultifluidf90EfferentGraph = svgPanZoom('#sourcefilemultifluidf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~multifluid.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemultifluidf90AfferentGraph" width="179pt" height="32pt"
 viewBox="0.00 0.00 179.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~multifluid.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~multifluid.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 175,-28 175,4 -4,4"/>
<!-- sourcefile~multifluid.f90 -->
<g id="sourcefile~~multifluid.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~multifluid.f90</title>
<polygon fill="none" stroke="#000000" points="73,-24 0,-24 0,0 73,0 73,-24"/>
<text text-anchor="middle" x="36.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">multifluid.f90</text>
</g>
<!-- sourcefile~gemini.f90 -->
<g id="sourcefile~~multifluid.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~gemini.f90</title>
<g id="a_sourcefile~~multifluid.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/gemini.f90.html" xlink:title="gemini.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="171,-24 109,-24 109,0 171,0 171,-24"/>
<text text-anchor="middle" x="140" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">gemini.f90</text>
</a>
</g>
</g>
<!-- sourcefile~gemini.f90&#45;&gt;sourcefile~multifluid.f90 -->
<g id="sourcefile~~multifluid.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~gemini.f90&#45;&gt;sourcefile~multifluid.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M108.9466,-12C100.9007,-12 92.0557,-12 83.3937,-12"/>
<polygon fill="#000000" stroke="#000000" points="83.3683,-8.5001 73.3683,-12 83.3682,-15.5001 83.3683,-8.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="190pt" height="32pt"
 viewBox="0.00 0.00 190.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 186,-28 186,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="67,-24 0,-24 0,0 67,0 67,-24"/>
<text text-anchor="middle" x="33.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="182,-24 85,-24 85,0 182,0 182,-24"/>
<text text-anchor="middle" x="133.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/multifluid.html">multifluid</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/multifluid.f90.html#src">multifluid.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="k">module </span><span class="n">multifluid</span>
<a name="ln-2"></a>
<a name="ln-3"></a><span class="k">use </span><span class="n">advec_mpi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">advec3d_mc_mpi</span><span class="p">,</span> <span class="n">advec_prep_mpi</span>
<a name="ln-4"></a><span class="k">use </span><span class="n">calculus</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">etd_uncoupled</span><span class="p">,</span> <span class="n">div3d</span>
<a name="ln-5"></a><span class="k">use </span><span class="n">collisions</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span>  <span class="n">thermal_conduct</span>
<a name="ln-6"></a><span class="k">use </span><span class="n">phys_consts</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">wp</span><span class="p">,</span><span class="n">pi</span><span class="p">,</span><span class="n">qs</span><span class="p">,</span><span class="n">lsp</span><span class="p">,</span><span class="n">gammas</span><span class="p">,</span><span class="n">kB</span><span class="p">,</span><span class="n">ms</span><span class="p">,</span><span class="n">mindensdiv</span><span class="p">,</span><span class="n">mindens</span><span class="p">,</span><span class="n">mindensnull</span><span class="p">,</span> <span class="n">debug</span>
<a name="ln-7"></a><span class="k">use </span><span class="n">diffusion</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span>  <span class="n">trbdf23d</span><span class="p">,</span> <span class="n">diffusion_prep</span>
<a name="ln-8"></a><span class="k">use </span><span class="n">grid</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">lx1</span><span class="p">,</span> <span class="n">lx2</span><span class="p">,</span> <span class="n">lx3</span><span class="p">,</span> <span class="n">gridflag</span>
<a name="ln-9"></a><span class="k">use </span><span class="n">mesh</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">curvmesh</span>
<a name="ln-10"></a><span class="k">use </span><span class="n">ionization</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">ionrate_glow98</span><span class="p">,</span> <span class="n">ionrate_fang08</span><span class="p">,</span> <span class="n">eheating</span><span class="p">,</span> <span class="n">photoionization</span>
<a name="ln-11"></a><span class="k">use </span><span class="n">mpimod</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">myid</span><span class="p">,</span><span class="n">tagns</span><span class="p">,</span><span class="n">tagvs1</span><span class="p">,</span><span class="n">tagTs</span>
<a name="ln-12"></a><span class="k">use </span><span class="n">precipBCs_mod</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">precipBCs_fileinput</span><span class="p">,</span> <span class="n">precipBCs</span>
<a name="ln-13"></a><span class="k">use </span><span class="n">sources</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">rk2_prep_mpi</span><span class="p">,</span> <span class="n">srcsenergy</span><span class="p">,</span> <span class="n">srcsmomentum</span><span class="p">,</span> <span class="n">srcscontinuity</span>
<a name="ln-14"></a><span class="k">use </span><span class="n">timeutils</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">sza</span>
<a name="ln-15"></a>
<a name="ln-16"></a><span class="k">implicit none</span>
<a name="ln-17"></a><span class="k">private</span>
<a name="ln-18"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">fluid_adv</span>
<a name="ln-19"></a>
<a name="ln-20"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">lprec</span><span class="o">=</span><span class="mi">2</span>    <span class="c">!number of precipitating electron populations</span>
<a name="ln-21"></a>
<a name="ln-22"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:,:)</span> <span class="kd">::</span> <span class="n">PrPrecipG</span>
<a name="ln-23"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:,:)</span> <span class="kd">::</span> <span class="n">QePrecipG</span><span class="p">,</span> <span class="n">iverG</span>
<a name="ln-24"></a>
<a name="ln-25"></a><span class="k">contains</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="k">subroutine </span><span class="n">fluid_adv</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">Ts</span><span class="p">,</span><span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span><span class="p">,</span><span class="n">J1</span><span class="p">,</span><span class="n">E1</span><span class="p">,</span><span class="n">Teinf</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">vn1</span><span class="p">,</span><span class="n">vn2</span><span class="p">,</span><span class="n">vn3</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">iver</span><span class="p">,</span><span class="n">f107</span><span class="p">,</span><span class="n">f107a</span><span class="p">,</span><span class="n">ymd</span><span class="p">,</span><span class="n">UTsec</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-28"></a>                   <span class="n">flagprecfile</span><span class="p">,</span><span class="n">dtprec</span><span class="p">,</span><span class="n">precdir</span><span class="p">,</span><span class="n">flagglow</span><span class="p">,</span><span class="n">dtglow</span><span class="p">)</span>    <span class="c">!J1 needed for heat conduction; E1 for momentum equation</span>
<a name="ln-29"></a>
<a name="ln-30"></a><span class="c">!------------------------------------------------------------</span>
<a name="ln-31"></a><span class="c">!-------THIS SUBROUTINE ADVANCES ALL OF THE FLUID VARIABLES</span>
<a name="ln-32"></a><span class="c">!------ BY TIME STEP DT.</span>
<a name="ln-33"></a><span class="c">!------------------------------------------------------------</span>
<a name="ln-34"></a>
<a name="ln-35"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">ns</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">Ts</span>
<a name="ln-36"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span>
<a name="ln-37"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">J1</span>       <span class="c">!needed for thermal conduction in electron population</span>
<a name="ln-38"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">E1</span>    <span class="c">!will have ambipolar field added into it in this procedure...</span>
<a name="ln-39"></a>
<a name="ln-40"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Teinf</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span>
<a name="ln-41"></a>
<a name="ln-42"></a><span class="k">type</span><span class="p">(</span><span class="n">curvmesh</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>                   <span class="c">!grid structure variable</span>
<a name="ln-43"></a>
<a name="ln-44"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nn</span>
<a name="ln-45"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vn1</span><span class="p">,</span><span class="n">vn2</span><span class="p">,</span><span class="n">vn3</span><span class="p">,</span><span class="n">Tn</span>
<a name="ln-46"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">f107</span><span class="p">,</span><span class="n">f107a</span>
<a name="ln-47"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ymd</span>
<a name="ln-48"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">UTsec</span>
<a name="ln-49"></a>
<a name="ln-50"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flagprecfile</span>
<a name="ln-51"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtprec</span>
<a name="ln-52"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">precdir</span>
<a name="ln-53"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flagglow</span>
<a name="ln-54"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dtglow</span>
<a name="ln-55"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iver</span>
<a name="ln-56"></a>
<a name="ln-57"></a><span class="kt">integer</span> <span class="kd">::</span> <span class="n">isp</span>
<a name="ln-58"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tstart</span><span class="p">,</span><span class="n">tfin</span>
<a name="ln-59"></a>
<a name="ln-60"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="kd">::</span>  <span class="n">rhovs1</span><span class="p">,</span><span class="n">rhoes</span>
<a name="ln-61"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">param</span>
<a name="ln-62"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">paramtrim</span><span class="p">,</span><span class="n">rhoeshalf</span><span class="p">,</span><span class="n">lambda</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">chrgflux</span>
<a name="ln-63"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">divvs</span>
<a name="ln-64"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">v1i</span>
<a name="ln-65"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">v2i</span>
<a name="ln-66"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">v3i</span>
<a name="ln-67"></a>
<a name="ln-68"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="kd">::</span> <span class="n">Pr</span><span class="p">,</span><span class="n">Lo</span>
<a name="ln-69"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Prprecip</span><span class="p">,</span><span class="n">Prpreciptmp</span>
<a name="ln-70"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Qeprecip</span><span class="p">,</span><span class="n">Qepreciptmp</span>
<a name="ln-71"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">chi</span>
<a name="ln-72"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">lprec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">W0</span><span class="p">,</span><span class="n">PhiWmWm2</span>
<a name="ln-73"></a>
<a name="ln-74"></a><span class="kt">integer</span> <span class="kd">::</span> <span class="n">iprec</span>
<a name="ln-75"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">v1iupdate</span>    <span class="c">!temp interface velocities for art. viscosity</span>
<a name="ln-76"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">vs1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dv1iupdate</span>    <span class="c">!interface diffs. for art. visc.</span>
<a name="ln-77"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="kd">::</span> <span class="n">Q</span>
<a name="ln-78"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">xicon</span><span class="o">=</span><span class="mf">3.0_wp</span>    <span class="c">!artifical viscosity, decent value for closed field-line grids extending to high altitudes, can be set to 0 for cartesian simulations not exceed altitudes of 1500 km.</span>
<a name="ln-79"></a>
<a name="ln-80"></a>
<a name="ln-81"></a><span class="c">!MAKING SURE THESE ARRAYS ARE ALWAYS IN SCOPE</span>
<a name="ln-82"></a><span class="k">if</span> <span class="p">((</span><span class="n">flagglow</span><span class="o">/=</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">NOT</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">PrprecipG</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-83"></a><span class="k">  allocate</span><span class="p">(</span><span class="n">PrprecipG</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-84"></a>  <span class="n">PrprecipG</span><span class="p">(:,:,:,:)</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-85"></a><span class="k">end if</span>
<a name="ln-86"></a><span class="k">if</span> <span class="p">((</span><span class="n">flagglow</span><span class="o">/=</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">NOT</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">QeprecipG</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-87"></a><span class="k">  allocate</span><span class="p">(</span><span class="n">QeprecipG</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">))</span>
<a name="ln-88"></a>  <span class="n">QeprecipG</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-89"></a><span class="k">end if</span>
<a name="ln-90"></a><span class="k">if</span> <span class="p">((</span><span class="n">flagglow</span><span class="o">/=</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">NOT</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">iverG</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-91"></a><span class="k">  allocate</span><span class="p">(</span><span class="n">iverG</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">iver</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">iver</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">iver</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<a name="ln-92"></a>  <span class="n">iverG</span><span class="p">(:,:,:)</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-93"></a><span class="k">end if</span>
<a name="ln-94"></a>
<a name="ln-95"></a>
<a name="ln-96"></a><span class="c">!CALCULATE THE INTERNAL ENERGY AND MOMENTUM FLUX DENSITIES (ADVECTION AND SOURCE SOLUTIONS ARE DONE IN THESE VARIABLES)</span>
<a name="ln-97"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-98"></a>  <span class="n">rhovs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">ms</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">vs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-99"></a>  <span class="n">rhoes</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">kB</span><span class="o">*</span><span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gammas</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">-</span><span class="mf">1._wp</span><span class="p">)</span>
<a name="ln-100"></a><span class="k">end do</span>
<a name="ln-101"></a>
<a name="ln-102"></a>
<a name="ln-103"></a><span class="c">!ADVECTION SUBSTEP (CONSERVED VARIABLES SHOULD BE UPDATED BEFORE ENTERING)</span>
<a name="ln-104"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tstart</span><span class="p">)</span>
<a name="ln-105"></a><span class="n">chrgflux</span><span class="o">=</span><span class="mf">0._wp</span>
<a name="ln-106"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-107"></a>  <span class="k">call </span><span class="n">advec_prep_mpi</span><span class="p">(</span><span class="n">isp</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">flagper</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">rhovs1</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span><span class="p">,</span><span class="n">rhoes</span><span class="p">,</span><span class="n">v1i</span><span class="p">,</span><span class="n">v2i</span><span class="p">,</span><span class="n">v3i</span><span class="p">)</span>    <span class="c">!role-agnostic communcation pattern (all-to-neighbors)</span>
<a name="ln-108"></a>
<a name="ln-109"></a>  <span class="k">if</span><span class="p">(</span><span class="n">isp</span><span class="o">&lt;</span><span class="n">lsp</span><span class="p">)</span> <span class="k">then</span>   <span class="c">!electron info found from charge neutrality and current density</span>
<a name="ln-110"></a>    <span class="n">param</span><span class="o">=</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-111"></a><span class="c">!    param=advec3D_MC_mpi(param,v1i,v2i,v3i,dt,x,0)   !last argument is tensor rank of thing being advected</span>
<a name="ln-112"></a>    <span class="n">param</span><span class="o">=</span><span class="n">advec3D_MC_mpi</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">v1i</span><span class="p">,</span><span class="n">v2i</span><span class="p">,</span><span class="n">v3i</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tagns</span><span class="p">)</span>   <span class="c">!second to last argument is tensor rank of thing being advected</span>
<a name="ln-113"></a>    <span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">param</span>
<a name="ln-114"></a>
<a name="ln-115"></a>    <span class="n">param</span><span class="o">=</span><span class="n">rhovs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-116"></a><span class="c">!    param=advec3D_MC_mpi(param,v1i,v2i,v3i,dt,x,1)</span>
<a name="ln-117"></a>    <span class="n">param</span><span class="o">=</span><span class="n">advec3D_MC_mpi</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">v1i</span><span class="p">,</span><span class="n">v2i</span><span class="p">,</span><span class="n">v3i</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">tagvs1</span><span class="p">)</span>
<a name="ln-118"></a>    <span class="n">rhovs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">param</span>
<a name="ln-119"></a>
<a name="ln-120"></a>    <span class="n">vs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">rhovs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ms</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">mindensdiv</span><span class="p">))</span>
<a name="ln-121"></a>    <span class="n">chrgflux</span><span class="o">=</span><span class="n">chrgflux</span><span class="o">+</span><span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">qs</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">vs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-122"></a>  <span class="k">else</span>
<a name="ln-123"></a><span class="k">    </span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-124"></a><span class="c">!      vs1(1:lx1,1:lx2,1:lx3,lsp)=1._wp/ns(1:lx1,1:lx2,1:lx3,lsp)/qs(lsp)*(J1-chrgflux)   !density floor needed???</span>
<a name="ln-125"></a>    <span class="n">vs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=-</span><span class="mf">1._wp</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">lsp</span><span class="p">),</span><span class="n">mindensdiv</span><span class="p">)</span><span class="o">/</span><span class="n">qs</span><span class="p">(</span><span class="n">lsp</span><span class="p">)</span><span class="o">*</span><span class="n">chrgflux</span>   <span class="c">!really not strictly correct, should include current density</span>
<a name="ln-126"></a>  <span class="k">end if</span>
<a name="ln-127"></a>
<a name="ln-128"></a><span class="k">  </span><span class="n">param</span><span class="o">=</span><span class="n">rhoes</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-129"></a><span class="c">!  param=advec3D_MC_mpi(param,v1i,v2i,v3i,dt,x,0)</span>
<a name="ln-130"></a>  <span class="n">param</span><span class="o">=</span><span class="n">advec3D_MC_mpi</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">v1i</span><span class="p">,</span><span class="n">v2i</span><span class="p">,</span><span class="n">v3i</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tagTs</span><span class="p">)</span>
<a name="ln-131"></a>  <span class="n">rhoes</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">param</span>
<a name="ln-132"></a><span class="k">end do</span>
<a name="ln-133"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tfin</span><span class="p">)</span>
<a name="ln-134"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-135"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Completed advection substep for time step:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; in cpu_time of:  &#39;</span><span class="p">,</span><span class="n">tfin</span><span class="o">-</span><span class="n">tstart</span>
<a name="ln-136"></a><span class="k">end if</span>
<a name="ln-137"></a>
<a name="ln-138"></a>
<a name="ln-139"></a><span class="c">!CLEAN DENSITY AND VELOCITY - SETS THE NULL CELLS TO SOME SENSIBLE VALUE SO</span>
<a name="ln-140"></a><span class="c">!THEY DON&#39;T MESS UP FINITE DIFFERENCES LATER</span>
<a name="ln-141"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-142"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">vs1</span><span class="p">)</span>
<a name="ln-143"></a>
<a name="ln-144"></a>
<a name="ln-145"></a><span class="c">!ARTIFICIAL VISCOSITY (NOT REALLY NEED BELOW 1000 KM ALT.).  NOTE THAT WE DON&#39;T CHECK WHERE SUBCYCLING IS NEEDED SINCE, IN MY EXPERIENCE THEN CODE IS BOMBING ANYTIME IT IS...</span>
<a name="ln-146"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-147"></a>  <span class="n">v1iupdate</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">=</span><span class="mf">0.5_wp</span><span class="o">*</span><span class="p">(</span><span class="n">vs1</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">+</span><span class="n">vs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">))</span>    <span class="c">!compute an updated interface velocity (only in x1-direction)</span>
<a name="ln-148"></a>  <span class="n">dv1iupdate</span><span class="o">=</span><span class="n">v1iupdate</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:)</span><span class="o">-</span><span class="n">v1iupdate</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,:,:)</span>
<a name="ln-149"></a>  <span class="n">Q</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">ms</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25_wp</span><span class="o">*</span><span class="n">xicon</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">dv1iupdate</span><span class="p">,</span><span class="mf">0._wp</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>   <span class="c">!note that viscosity does not have/need ghost cells</span>
<a name="ln-150"></a><span class="k">end do</span>
<a name="ln-151"></a><span class="n">Q</span><span class="p">(:,:,:,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=</span><span class="mf">0._wp</span>
<a name="ln-152"></a>
<a name="ln-153"></a>
<a name="ln-154"></a><span class="c">!NONSTIFF/NONBALANCE INTERNAL ENERGY SOURCES (RK2 INTEGRATION)</span>
<a name="ln-155"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tstart</span><span class="p">)</span>
<a name="ln-156"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-157"></a>  <span class="k">call </span><span class="n">RK2_prep_mpi</span><span class="p">(</span><span class="n">isp</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">flagper</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span><span class="p">)</span>    <span class="c">!role-agnostic mpi, all-to-neighbor</span>
<a name="ln-158"></a>
<a name="ln-159"></a>  <span class="n">divvs</span><span class="o">=</span><span class="n">div3D</span><span class="p">(</span><span class="n">vs1</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lx3</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">isp</span><span class="p">),</span><span class="n">vs2</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lx3</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">isp</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-160"></a>             <span class="n">vs3</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">lx3</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">isp</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">lx2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">lx3</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>    <span class="c">!diff with one set of ghost cells to preserve second order accuracy over the grid</span>
<a name="ln-161"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">rhoes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-162"></a>  <span class="n">rhoeshalf</span><span class="o">=</span><span class="n">paramtrim</span><span class="o">-</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0_wp</span><span class="o">*</span><span class="p">(</span><span class="n">paramtrim</span><span class="o">*</span><span class="p">(</span><span class="n">gammas</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">-</span><span class="mf">1._wp</span><span class="p">)</span><span class="o">+</span><span class="n">Q</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">))</span><span class="o">*</span><span class="n">divvs</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">)</span> <span class="c">!t+dt/2 value of internal energy, use only interior points of divvs for second order accuracy</span>
<a name="ln-163"></a>
<a name="ln-164"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">paramtrim</span><span class="o">-</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">rhoeshalf</span><span class="o">*</span><span class="p">(</span><span class="n">gammas</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">-</span><span class="mf">1._wp</span><span class="p">)</span><span class="o">+</span><span class="n">Q</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">))</span><span class="o">*</span><span class="n">divvs</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">)</span>
<a name="ln-165"></a>  <span class="n">rhoes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">paramtrim</span>
<a name="ln-166"></a>
<a name="ln-167"></a>  <span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">gammas</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">-</span><span class="mf">1._wp</span><span class="p">)</span><span class="o">/</span><span class="n">kB</span><span class="o">*</span><span class="n">rhoes</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">mindensdiv</span><span class="p">)</span>
<a name="ln-168"></a>  <span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="mi">10</span><span class="mf">0._wp</span><span class="p">)</span>
<a name="ln-169"></a><span class="k">end do</span>
<a name="ln-170"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tfin</span><span class="p">)</span>
<a name="ln-171"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-172"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Completed compression substep for time step:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; in cpu_time of:  &#39;</span><span class="p">,</span><span class="n">tfin</span><span class="o">-</span><span class="n">tstart</span>
<a name="ln-173"></a><span class="k">end if</span>
<a name="ln-174"></a>
<a name="ln-175"></a><span class="c">!CLEAN TEMPERATURE</span>
<a name="ln-176"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">Ts</span><span class="p">)</span>
<a name="ln-177"></a>
<a name="ln-178"></a>
<a name="ln-179"></a><span class="c">!DIFFUSION OF ENERGY</span>
<a name="ln-180"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tstart</span><span class="p">)</span>
<a name="ln-181"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-182"></a>  <span class="n">param</span><span class="o">=</span><span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span>     <span class="c">!temperature for this species</span>
<a name="ln-183"></a>  <span class="k">call </span><span class="n">thermal_conduct</span><span class="p">(</span><span class="n">isp</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">nn</span><span class="p">,</span><span class="n">J1</span><span class="p">,</span><span class="n">lambda</span><span class="p">,</span><span class="n">beta</span><span class="p">)</span>
<a name="ln-184"></a>
<a name="ln-185"></a>  <span class="k">call </span><span class="n">diffusion_prep</span><span class="p">(</span><span class="n">isp</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">lambda</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">param</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">Teinf</span><span class="p">)</span>
<a name="ln-186"></a><span class="c">!      param=backEuler3D(param,A,B,C,D,E,dt,dx1,dx1i)    !1st order method, likely deprecated but needs to be kept here for debug purposes, perhaps?</span>
<a name="ln-187"></a>  <span class="n">param</span><span class="o">=</span><span class="n">TRBDF23D</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a name="ln-188"></a>  <span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">param</span>
<a name="ln-189"></a>  <span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="mi">10</span><span class="mf">0._wp</span><span class="p">)</span>
<a name="ln-190"></a><span class="k">end do</span>
<a name="ln-191"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tfin</span><span class="p">)</span>
<a name="ln-192"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-193"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Completed energy diffusion substep for time step:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; in cpu_time of:  &#39;</span><span class="p">,</span><span class="n">tfin</span><span class="o">-</span><span class="n">tstart</span>
<a name="ln-194"></a><span class="k">end if</span>
<a name="ln-195"></a>
<a name="ln-196"></a><span class="c">!ZZZ - CLEAN TEMPERATURE BEFORE CONVERTING TO INTERNAL ENERGY</span>
<a name="ln-197"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">Ts</span><span class="p">)</span>
<a name="ln-198"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-199"></a>  <span class="n">rhoes</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">kB</span><span class="o">*</span><span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">gammas</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">-</span><span class="mf">1._wp</span><span class="p">)</span>
<a name="ln-200"></a><span class="k">end do</span>
<a name="ln-201"></a>
<a name="ln-202"></a><span class="c">!LOAD ELECTRON PRECIPITATION PATTERN</span>
<a name="ln-203"></a><span class="k">if</span> <span class="p">(</span><span class="n">flagprecfile</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-204"></a><span class="k">  call </span><span class="n">precipBCs_fileinput</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">dtprec</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">ymd</span><span class="p">,</span><span class="n">UTsec</span><span class="p">,</span><span class="n">precdir</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">W0</span><span class="p">,</span><span class="n">PhiWmWm2</span><span class="p">)</span>
<a name="ln-205"></a><span class="k">else</span>     <span class="c">!no file input specified, so just call &#39;regular&#39; function</span>
<a name="ln-206"></a>  <span class="k">call </span><span class="n">precipBCs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">W0</span><span class="p">,</span><span class="n">PhiWmWm2</span><span class="p">)</span>
<a name="ln-207"></a><span class="k">end if</span>
<a name="ln-208"></a>
<a name="ln-209"></a>
<a name="ln-210"></a><span class="c">!STIFF/BALANCED ENERGY SOURCES</span>
<a name="ln-211"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tstart</span><span class="p">)</span>
<a name="ln-212"></a><span class="n">Prprecip</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-213"></a><span class="n">Qeprecip</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-214"></a><span class="n">Prpreciptmp</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-215"></a><span class="n">Qepreciptmp</span><span class="o">=</span><span class="mf">0.0_wp</span>
<a name="ln-216"></a><span class="k">if</span> <span class="p">(</span><span class="n">gridflag</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-217"></a><span class="k">  if</span><span class="p">(</span><span class="n">flagglow</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!RUN FANG APPROXIMATION</span>
<a name="ln-218"></a>    <span class="k">do </span><span class="n">iprec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lprec</span>    <span class="c">!loop over the different populations of precipitation (2 here?), accumulating production rates</span>
<a name="ln-219"></a>      <span class="n">Prpreciptmp</span><span class="o">=</span><span class="n">ionrate_fang08</span><span class="p">(</span><span class="n">W0</span><span class="p">(:,:,</span><span class="n">iprec</span><span class="p">),</span><span class="n">PhiWmWm2</span><span class="p">(:,:,</span><span class="n">iprec</span><span class="p">),</span><span class="n">x</span><span class="p">%</span><span class="n">alt</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">Tn</span><span class="p">)</span>    <span class="c">!calculation based on Fang et al [2008]</span>
<a name="ln-220"></a>      <span class="n">Prprecip</span><span class="o">=</span><span class="n">Prprecip</span><span class="o">+</span><span class="n">Prpreciptmp</span>
<a name="ln-221"></a>    <span class="k">end do</span>
<a name="ln-222"></a><span class="k">    </span><span class="n">Prprecip</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">Prprecip</span><span class="p">,</span><span class="mf">1e-5_wp</span><span class="p">)</span>
<a name="ln-223"></a>    <span class="n">Qeprecip</span><span class="o">=</span><span class="n">eheating</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">Prprecip</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-224"></a>  <span class="k">else</span>      <span class="c">!GLOW USED, AURORA PRODUCED</span>
<a name="ln-225"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">dtglow</span><span class="p">)</span><span class="o">/=</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">+</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="n">dtglow</span><span class="p">).</span><span class="nb">OR</span><span class="p">.</span><span class="n">t</span><span class="o">&lt;</span><span class="mf">0.1_wp</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-226"></a><span class="k">      </span><span class="n">PrprecipG</span><span class="o">=</span><span class="mf">0.0_wp</span><span class="p">;</span> <span class="n">QeprecipG</span><span class="o">=</span><span class="mf">0.0_wp</span><span class="p">;</span> <span class="n">iverG</span><span class="o">=</span><span class="mf">0.0_wp</span><span class="p">;</span>
<a name="ln-227"></a>      <span class="k">call </span><span class="n">ionrate_glow98</span><span class="p">(</span><span class="n">W0</span><span class="p">,</span><span class="n">PhiWmWm2</span><span class="p">,</span><span class="n">ymd</span><span class="p">,</span><span class="n">UTsec</span><span class="p">,</span><span class="n">f107</span><span class="p">,</span><span class="n">f107a</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">glat</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:),</span><span class="n">x</span><span class="p">%</span><span class="n">glon</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:),</span><span class="n">x</span><span class="p">%</span><span class="n">alt</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">Ts</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-228"></a>                          <span class="n">QeprecipG</span><span class="p">,</span> <span class="n">iverG</span><span class="p">,</span> <span class="n">PrprecipG</span><span class="p">)</span>
<a name="ln-229"></a>      <span class="n">PrprecipG</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">PrprecipG</span><span class="p">,</span> <span class="mf">1e-5_wp</span><span class="p">)</span>
<a name="ln-230"></a>    <span class="k">end if</span>
<a name="ln-231"></a><span class="k">    </span><span class="n">Prprecip</span><span class="o">=</span><span class="n">PrprecipG</span>
<a name="ln-232"></a>    <span class="n">Qeprecip</span><span class="o">=</span><span class="n">QeprecipG</span>
<a name="ln-233"></a>    <span class="n">iver</span><span class="o">=</span><span class="n">iverG</span>
<a name="ln-234"></a>  <span class="k">end if</span>
<a name="ln-235"></a><span class="k">else</span>    <span class="c">!do not compute impact ionization on a closed mesh (presumably there is no source of energetic electrons at these lats.)</span>
<a name="ln-236"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-237"></a><span class="k">    if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Looks like we have a closed grid, so skipping impact ionization for time step:  &#39;</span><span class="p">,</span><span class="n">t</span>
<a name="ln-238"></a>  <span class="k">end if</span>
<a name="ln-239"></a><span class="k">end if</span>
<a name="ln-240"></a>
<a name="ln-241"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-242"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Min/max root electron impact ionization production rates for time:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; :  &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-243"></a>    <span class="nb">minval</span><span class="p">(</span><span class="n">Prprecip</span><span class="p">),</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">Prprecip</span><span class="p">)</span>
<a name="ln-244"></a><span class="k">end if</span>
<a name="ln-245"></a>
<a name="ln-246"></a><span class="k">if</span> <span class="p">((</span><span class="n">flagglow</span><span class="o">/=</span><span class="mi">0</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-247"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Min/max 427.8 nm emission column-integrated intensity for time:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; :  &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-248"></a>    <span class="nb">minval</span><span class="p">(</span><span class="n">iver</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">maxval</span><span class="p">(</span><span class="n">iver</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">))</span>
<a name="ln-249"></a><span class="k">end if</span>
<a name="ln-250"></a>
<a name="ln-251"></a><span class="c">!&gt; now add in photoionization sources</span>
<a name="ln-252"></a><span class="n">chi</span><span class="o">=</span><span class="n">sza</span><span class="p">(</span><span class="n">ymd</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ymd</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ymd</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">UTsec</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">glat</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">glon</span><span class="p">)</span>
<a name="ln-253"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-254"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Computing photoionization for time:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; using sza range of (root only):  &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-255"></a>              <span class="nb">minval</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span><span class="o">*</span><span class="mi">18</span><span class="mf">0._wp</span><span class="o">/</span><span class="n">pi</span><span class="p">,</span><span class="nb">maxval</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span><span class="o">*</span><span class="mi">18</span><span class="mf">0._wp</span><span class="o">/</span><span class="n">pi</span>
<a name="ln-256"></a><span class="k">end if</span>
<a name="ln-257"></a>
<a name="ln-258"></a><span class="n">Prpreciptmp</span><span class="o">=</span><span class="n">photoionization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">chi</span><span class="p">,</span><span class="n">f107</span><span class="p">,</span><span class="n">f107a</span><span class="p">)</span>
<a name="ln-259"></a>
<a name="ln-260"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-261"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Min/max root photoionization production rates for time:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39; :  &#39;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">Prpreciptmp</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-262"></a>              <span class="nb">maxval</span><span class="p">(</span><span class="n">Prpreciptmp</span><span class="p">)</span>
<a name="ln-263"></a><span class="k">end if</span>
<a name="ln-264"></a>
<a name="ln-265"></a><span class="n">Prpreciptmp</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">Prpreciptmp</span><span class="p">,</span><span class="mf">1e-5_wp</span><span class="p">)</span>
<a name="ln-266"></a><span class="c">!! enforce minimum production rate to preserve conditioning for species that rely on constant production</span>
<a name="ln-267"></a><span class="c">!! testing should probably be done to see what the best choice is...</span>
<a name="ln-268"></a>
<a name="ln-269"></a><span class="n">Qepreciptmp</span><span class="o">=</span><span class="n">eheating</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">Prpreciptmp</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-270"></a><span class="c">!! thermal electron heating rate from Swartz and Nisbet, (1978)</span>
<a name="ln-271"></a>
<a name="ln-272"></a><span class="c">!&gt; photoion ionrate and heating calculated seperately, added together with ionrate and heating from Fang or GLOW</span>
<a name="ln-273"></a><span class="n">Prprecip</span><span class="o">=</span><span class="n">Prprecip</span><span class="o">+</span><span class="n">Prpreciptmp</span>
<a name="ln-274"></a><span class="n">Qeprecip</span><span class="o">=</span><span class="n">Qeprecip</span><span class="o">+</span><span class="n">Qepreciptmp</span>
<a name="ln-275"></a>
<a name="ln-276"></a><span class="k">call </span><span class="n">srcsEnergy</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">vn1</span><span class="p">,</span><span class="n">vn2</span><span class="p">,</span><span class="n">vn3</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span><span class="p">,</span><span class="n">Ts</span><span class="p">,</span><span class="n">Pr</span><span class="p">,</span><span class="n">Lo</span><span class="p">)</span>
<a name="ln-277"></a>
<a name="ln-278"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-279"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">isp</span><span class="o">==</span><span class="n">lsp</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-280"></a><span class="k">    </span><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=</span><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="n">lsp</span><span class="p">)</span><span class="o">+</span><span class="n">Qeprecip</span>
<a name="ln-281"></a>  <span class="k">end if</span>
<a name="ln-282"></a><span class="k">  </span><span class="n">paramtrim</span><span class="o">=</span><span class="n">rhoes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-283"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">ETD_uncoupled</span><span class="p">(</span><span class="n">paramtrim</span><span class="p">,</span><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">Lo</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">dt</span><span class="p">)</span>
<a name="ln-284"></a>  <span class="n">rhoes</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">paramtrim</span>
<a name="ln-285"></a>
<a name="ln-286"></a>  <span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="n">gammas</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">-</span><span class="mf">1._wp</span><span class="p">)</span><span class="o">/</span><span class="n">kB</span><span class="o">*</span><span class="n">rhoes</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">mindensdiv</span><span class="p">)</span>
<a name="ln-287"></a>  <span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="mi">10</span><span class="mf">0._wp</span><span class="p">)</span>
<a name="ln-288"></a><span class="k">end do</span>
<a name="ln-289"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tfin</span><span class="p">)</span>
<a name="ln-290"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-291"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Energy sources substep for time step:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;done in cpu_time of:  &#39;</span><span class="p">,</span><span class="n">tfin</span><span class="o">-</span><span class="n">tstart</span>
<a name="ln-292"></a><span class="k">end if</span>
<a name="ln-293"></a>
<a name="ln-294"></a><span class="c">!CLEAN TEMPERATURE</span>
<a name="ln-295"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">Ts</span><span class="p">)</span>
<a name="ln-296"></a>
<a name="ln-297"></a><span class="c">!ALL VELOCITY SOURCES</span>
<a name="ln-298"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tstart</span><span class="p">)</span>
<a name="ln-299"></a><span class="k">call </span><span class="n">srcsMomentum</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">vn1</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span><span class="p">,</span><span class="n">Ts</span><span class="p">,</span><span class="n">E1</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">Pr</span><span class="p">,</span><span class="n">Lo</span><span class="p">)</span>    <span class="c">!added artificial viscosity...</span>
<a name="ln-300"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-301"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">rhovs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-302"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">ETD_uncoupled</span><span class="p">(</span><span class="n">paramtrim</span><span class="p">,</span><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">Lo</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">dt</span><span class="p">)</span>
<a name="ln-303"></a>  <span class="n">rhovs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">paramtrim</span>
<a name="ln-304"></a>
<a name="ln-305"></a>  <span class="n">vs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">rhovs1</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ms</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">mindensdiv</span><span class="p">))</span>
<a name="ln-306"></a><span class="k">end do</span>
<a name="ln-307"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tfin</span><span class="p">)</span>
<a name="ln-308"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-309"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Velocity sources substep for time step:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;done in cpu_time of:  &#39;</span><span class="p">,</span><span class="n">tfin</span><span class="o">-</span><span class="n">tstart</span>
<a name="ln-310"></a><span class="k">end if</span>
<a name="ln-311"></a>
<a name="ln-312"></a>
<a name="ln-313"></a><span class="c">!ELECTRON VELOCITY SOLUTION</span>
<a name="ln-314"></a><span class="n">chrgflux</span><span class="o">=</span><span class="mf">0._wp</span>
<a name="ln-315"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-316"></a>  <span class="n">chrgflux</span><span class="o">=</span><span class="n">chrgflux</span><span class="o">+</span><span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">qs</span><span class="p">(</span><span class="n">isp</span><span class="p">)</span><span class="o">*</span><span class="n">vs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-317"></a><span class="k">end do</span>
<a name="ln-318"></a><span class="c">!  vs1(1:lx1,1:lx2,1:lx3,lsp)=1._wp/max(ns(1:lx1,1:lx2,1:lx3,lsp),mindensdiv)/qs(lsp)*(J1-chrgflux)   !density floor needed???</span>
<a name="ln-319"></a><span class="n">vs1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=-</span><span class="mf">1._wp</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">lsp</span><span class="p">),</span><span class="n">mindensdiv</span><span class="p">)</span><span class="o">/</span><span class="n">qs</span><span class="p">(</span><span class="n">lsp</span><span class="p">)</span><span class="o">*</span><span class="n">chrgflux</span>    <span class="c">!don&#39;t bother with FAC contribution...</span>
<a name="ln-320"></a>
<a name="ln-321"></a>
<a name="ln-322"></a><span class="c">!CLEAN VELOCITY</span>
<a name="ln-323"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">vs1</span><span class="p">)</span>
<a name="ln-324"></a>
<a name="ln-325"></a>
<a name="ln-326"></a><span class="c">!ALL MASS SOURCES</span>
<a name="ln-327"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tstart</span><span class="p">)</span>
<a name="ln-328"></a><span class="k">call </span><span class="n">srcsContinuity</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">vn1</span><span class="p">,</span><span class="n">vn2</span><span class="p">,</span><span class="n">vn3</span><span class="p">,</span><span class="n">Tn</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">vs1</span><span class="p">,</span><span class="n">vs2</span><span class="p">,</span><span class="n">vs3</span><span class="p">,</span><span class="n">Ts</span><span class="p">,</span><span class="n">Pr</span><span class="p">,</span><span class="n">Lo</span><span class="p">)</span>
<a name="ln-329"></a><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span><span class="o">=</span><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="n">Prprecip</span>
<a name="ln-330"></a><span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-331"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-332"></a>  <span class="n">paramtrim</span><span class="o">=</span><span class="n">ETD_uncoupled</span><span class="p">(</span><span class="n">paramtrim</span><span class="p">,</span><span class="n">Pr</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">Lo</span><span class="p">(:,:,:,</span><span class="n">isp</span><span class="p">),</span><span class="n">dt</span><span class="p">)</span>
<a name="ln-333"></a>  <span class="n">ns</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">paramtrim</span>    <span class="c">!should there be a density floor here???  I think so...</span>
<a name="ln-334"></a><span class="k">end do</span>
<a name="ln-335"></a><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">tfin</span><span class="p">)</span>
<a name="ln-336"></a><span class="k">if</span> <span class="p">(</span><span class="n">myid</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-337"></a><span class="k">  if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s1">&#39;Mass sources substep for time step:  &#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;done in cpu_time of:  &#39;</span><span class="p">,</span><span class="n">tfin</span><span class="o">-</span><span class="n">tstart</span>
<a name="ln-338"></a><span class="k">end if</span>
<a name="ln-339"></a>
<a name="ln-340"></a>
<a name="ln-341"></a><span class="c">!ELECTRON DENSITY SOLUTION</span>
<a name="ln-342"></a><span class="n">ns</span><span class="p">(:,:,:,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">ns</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-343"></a>
<a name="ln-344"></a>
<a name="ln-345"></a><span class="c">!CLEAN DENSITY (CONSERVED VARIABLES WILL BE RECOMPUTED AT THE BEGINNING OF NEXT TIME STEP</span>
<a name="ln-346"></a><span class="k">call </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
<a name="ln-347"></a>
<a name="ln-348"></a><span class="c">!should the electron velocity be recomputed here now that densities have changed...</span>
<a name="ln-349"></a>
<a name="ln-350"></a><span class="k">end subroutine </span><span class="n">fluid_adv</span>
<a name="ln-351"></a>
<a name="ln-352"></a>
<a name="ln-353"></a><span class="k">subroutine </span><span class="n">clean_param</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">paramflag</span><span class="p">,</span><span class="n">param</span><span class="p">)</span>
<a name="ln-354"></a>
<a name="ln-355"></a><span class="c">!------------------------------------------------------------</span>
<a name="ln-356"></a><span class="c">!-------THIS SUBROUTINE ZEROS OUT ALL NULL CELLS AND HANDLES</span>
<a name="ln-357"></a><span class="c">!-------POSSIBLE NULL ARTIFACTS AT BOUNDARIES</span>
<a name="ln-358"></a><span class="c">!------------------------------------------------------------</span>
<a name="ln-359"></a>
<a name="ln-360"></a><span class="k">type</span><span class="p">(</span><span class="n">curvmesh</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span>
<a name="ln-361"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">paramflag</span>
<a name="ln-362"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">param</span>     <span class="c">!note that this is 4D and is meant to include ghost cells</span>
<a name="ln-363"></a>
<a name="ln-364"></a><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">lsp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">paramnew</span>
<a name="ln-365"></a><span class="kt">integer</span> <span class="kd">::</span> <span class="n">isp</span><span class="p">,</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">iinull</span><span class="p">,</span><span class="n">ix1beg</span><span class="p">,</span><span class="n">ix1end</span>
<a name="ln-366"></a>
<a name="ln-367"></a>
<a name="ln-368"></a><span class="k">select case</span> <span class="p">(</span><span class="n">paramflag</span><span class="p">)</span>
<a name="ln-369"></a>  <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c">!density</span>
<a name="ln-370"></a>    <span class="n">param</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">param</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">mindens</span><span class="p">)</span>
<a name="ln-371"></a>    <span class="n">param</span><span class="p">(:,:,:,</span><span class="n">lsp</span><span class="p">)</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">param</span><span class="p">(:,:,:,</span><span class="mi">1</span><span class="p">:</span><span class="n">lsp</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>       <span class="c">!enforce charge neutrality based on ion densities</span>
<a name="ln-372"></a>
<a name="ln-373"></a>    <span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>             <span class="c">!set null cells to some value</span>
<a name="ln-374"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">isp</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-375"></a><span class="k">        do </span><span class="n">iinull</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">lnull</span>
<a name="ln-376"></a>          <span class="n">ix1</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-377"></a>          <span class="n">ix2</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-378"></a>          <span class="n">ix3</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-379"></a>
<a name="ln-380"></a>          <span class="n">param</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">mindensnull</span><span class="o">*</span><span class="mf">1e-2_wp</span>
<a name="ln-381"></a>        <span class="k">end do</span>
<a name="ln-382"></a><span class="k">      else</span>
<a name="ln-383"></a><span class="k">        do </span><span class="n">iinull</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">lnull</span>
<a name="ln-384"></a>          <span class="n">ix1</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-385"></a>          <span class="n">ix2</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-386"></a>          <span class="n">ix3</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-387"></a>
<a name="ln-388"></a>          <span class="n">param</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">mindensnull</span>
<a name="ln-389"></a>        <span class="k">end do</span>
<a name="ln-390"></a><span class="k">      end if</span>
<a name="ln-391"></a><span class="k">    end do</span>
<a name="ln-392"></a>
<a name="ln-393"></a>
<a name="ln-394"></a>    <span class="c">!SET DENSITY TO SOME HARMLESS VALUE</span>
<a name="ln-395"></a>    <span class="n">param</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">mindensdiv</span>
<a name="ln-396"></a>    <span class="n">param</span><span class="p">(</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="n">mindensdiv</span>
<a name="ln-397"></a>    <span class="n">param</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">mindensdiv</span>
<a name="ln-398"></a>    <span class="n">param</span><span class="p">(:,</span><span class="n">lx2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)</span><span class="o">=</span><span class="n">mindensdiv</span>
<a name="ln-399"></a>    <span class="n">param</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,:)</span><span class="o">=</span><span class="n">mindensdiv</span>
<a name="ln-400"></a>    <span class="n">param</span><span class="p">(:,:,</span><span class="n">lx3</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="n">mindensdiv</span>
<a name="ln-401"></a>  <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c">!velocity</span>
<a name="ln-402"></a>    <span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>       <span class="c">!set null cells to zero mometnum</span>
<a name="ln-403"></a>      <span class="k">do </span><span class="n">iinull</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">lnull</span>
<a name="ln-404"></a>        <span class="n">ix1</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-405"></a>        <span class="n">ix2</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-406"></a>        <span class="n">ix3</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-407"></a>
<a name="ln-408"></a>        <span class="n">param</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="mf">0._wp</span>
<a name="ln-409"></a>      <span class="k">end do</span>
<a name="ln-410"></a><span class="k">    end do</span>
<a name="ln-411"></a>
<a name="ln-412"></a>    <span class="c">!FORCE THE BORDER CELLS TO BE SAME AS THE FIRST INTERIOR CELL (deals with some issues on dipole grids)</span>
<a name="ln-413"></a>    <span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>
<a name="ln-414"></a>      <span class="k">do </span><span class="n">ix3</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lx3</span>
<a name="ln-415"></a>        <span class="k">do </span><span class="n">ix2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lx2</span>
<a name="ln-416"></a>          <span class="n">ix1beg</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-417"></a>          <span class="k">do while</span><span class="p">(</span><span class="n">x</span><span class="p">%</span><span class="n">nullpts</span><span class="p">(</span><span class="n">ix1beg</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.5_wp</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ix1beg</span><span class="o">&lt;</span><span class="n">lx1</span><span class="p">)</span>     <span class="c">!find the first non-null index for this field line, need to be careful if no null points exist...</span>
<a name="ln-418"></a>            <span class="n">ix1beg</span><span class="o">=</span><span class="n">ix1beg</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-419"></a>          <span class="k">end do</span>
<a name="ln-420"></a>
<a name="ln-421"></a><span class="k">          </span><span class="n">ix1end</span><span class="o">=</span><span class="n">ix1beg</span>
<a name="ln-422"></a>          <span class="k">do while</span><span class="p">(</span><span class="n">x</span><span class="p">%</span><span class="n">nullpts</span><span class="p">(</span><span class="n">ix1end</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.5_wp</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">ix1end</span><span class="o">&lt;</span><span class="n">lx1</span><span class="p">)</span>     <span class="c">!find the first non-null index for this field line</span>
<a name="ln-423"></a>            <span class="n">ix1end</span><span class="o">=</span><span class="n">ix1end</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-424"></a>          <span class="k">end do</span>
<a name="ln-425"></a>
<a name="ln-426"></a><span class="k">          if</span> <span class="p">(</span><span class="n">ix1beg</span> <span class="o">/=</span> <span class="n">lx1</span><span class="p">)</span> <span class="k">then</span>    <span class="c">!only do this if we actually have null grid points</span>
<a name="ln-427"></a>            <span class="n">param</span><span class="p">(</span><span class="n">ix1beg</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">param</span><span class="p">(</span><span class="n">ix1beg</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-428"></a>            <span class="n">param</span><span class="p">(</span><span class="n">ix1end</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="n">param</span><span class="p">(</span><span class="n">ix1end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span>
<a name="ln-429"></a>          <span class="k">end if</span>
<a name="ln-430"></a><span class="k">        end do</span>
<a name="ln-431"></a><span class="k">      end do</span>
<a name="ln-432"></a><span class="k">    end do</span>
<a name="ln-433"></a>
<a name="ln-434"></a><span class="c">!MZ - for reasons I don&#39;t understand, this causes ctest to fail...</span>
<a name="ln-435"></a><span class="c">!    !ZERO OUT THE GHOST CELL VELOCITIES</span>
<a name="ln-436"></a><span class="c">!    param(-1:0,:,:,:)=0._wp</span>
<a name="ln-437"></a><span class="c">!    param(lx1+1:lx1+2,:,:,:)=0._wp</span>
<a name="ln-438"></a><span class="c">!    param(:,-1:0,:,:)=0._wp</span>
<a name="ln-439"></a><span class="c">!    param(:,lx2+1:lx2+2,:,:)=0._wp</span>
<a name="ln-440"></a><span class="c">!    param(:,:,-1:0,:)=0._wp</span>
<a name="ln-441"></a><span class="c">!    param(:,:,lx4+1:lx3+2,:)=0._wp</span>
<a name="ln-442"></a>  <span class="k">case</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>    <span class="c">!temperature</span>
<a name="ln-443"></a>    <span class="n">param</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">param</span><span class="p">,</span><span class="mi">10</span><span class="mf">0._wp</span><span class="p">)</span>     <span class="c">!temperature floor</span>
<a name="ln-444"></a>
<a name="ln-445"></a>    <span class="k">do </span><span class="n">isp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lsp</span>       <span class="c">!set null cells to some value</span>
<a name="ln-446"></a>      <span class="k">do </span><span class="n">iinull</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">%</span><span class="n">lnull</span>
<a name="ln-447"></a>        <span class="n">ix1</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-448"></a>        <span class="n">ix2</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-449"></a>        <span class="n">ix3</span><span class="o">=</span><span class="n">x</span><span class="p">%</span><span class="n">inull</span><span class="p">(</span><span class="n">iinull</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-450"></a>
<a name="ln-451"></a>        <span class="n">param</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span><span class="p">,</span><span class="n">isp</span><span class="p">)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-452"></a>      <span class="k">end do</span>
<a name="ln-453"></a><span class="k">    end do</span>
<a name="ln-454"></a>
<a name="ln-455"></a>
<a name="ln-456"></a>    <span class="c">!SET TEMPS TO SOME NOMINAL VALUE</span>
<a name="ln-457"></a>    <span class="n">param</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-458"></a>    <span class="n">param</span><span class="p">(</span><span class="n">lx1</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lx1</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:,:)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-459"></a>    <span class="n">param</span><span class="p">(:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,:,:)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-460"></a>    <span class="n">param</span><span class="p">(:,</span><span class="n">lx2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lx2</span><span class="o">+</span><span class="mi">2</span><span class="p">,:,:)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-461"></a>    <span class="n">param</span><span class="p">(:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,:)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-462"></a>    <span class="n">param</span><span class="p">(:,:,</span><span class="n">lx3</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lx3</span><span class="o">+</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="mi">10</span><span class="mf">0._wp</span>
<a name="ln-463"></a>  <span class="k">case </span><span class="n">default</span>    <span class="c">!do nothing...</span>
<a name="ln-464"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="k">print</span> <span class="o">*</span><span class="p">,</span>  <span class="s1">&#39;!non-standard parameter selected in clean_params...&#39;</span>
<a name="ln-465"></a><span class="k">end select</span>
<a name="ln-466"></a>
<a name="ln-467"></a><span class="k">end subroutine </span><span class="n">clean_param</span>
<a name="ln-468"></a>
<a name="ln-469"></a><span class="k">end module </span><span class="n">multifluid</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> GEMINI3D was developed by Matthew Zettergren
Guy Grubbs
Michael Hirsch</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    
  </body>
</html>